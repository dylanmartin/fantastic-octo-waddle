2024-08-26 05:12:52,511 - SimulatorRunner - WARNING - The number of threads is not provided. Set it to default: 1
2024-08-26 05:12:52,512 - SimulatorRunner - INFO - Create the Simulator Server.
2024-08-26 05:12:54,143 - CoreCell - INFO - server: creating listener on tcp://0:53227
2024-08-26 05:12:54,179 - CoreCell - INFO - server: created backbone external listener for tcp://0:53227
2024-08-26 05:12:54,180 - ConnectorManager - INFO - 88272: Try start_listener Listener resources: {'secure': False, 'host': 'localhost'}
2024-08-26 05:12:54,182 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connector [CH00002 PASSIVE tcp://0:49633] is starting
2024-08-26 05:12:54,685 - CoreCell - INFO - server: created backbone internal listener for tcp://localhost:49633
2024-08-26 05:12:54,686 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connector [CH00001 PASSIVE tcp://0:53227] is starting
2024-08-26 05:12:54,756 - nvflare.fuel.hci.server.hci - INFO - Starting Admin Server localhost on Port 47809
2024-08-26 05:12:54,756 - SimulatorRunner - INFO - Deploy the Apps.
2024-08-26 05:12:54,813 - SimulatorRunner - INFO - Create the simulate clients.
2024-08-26 05:12:54,831 - ClientManager - INFO - Client: New client site1@172.19.0.2 joined. Sent token: 0d567059-0811-4997-b97b-704439e31780.  Total clients: 1
2024-08-26 05:12:54,833 - FederatedClient - INFO - Successfully registered client:site1 for project simulator_server. Token:0d567059-0811-4997-b97b-704439e31780 SSID:
2024-08-26 05:12:54,836 - ClientManager - INFO - Client: New client site2@172.19.0.2 joined. Sent token: 98af6db9-b718-4286-ad11-791e3466c5dc.  Total clients: 2
2024-08-26 05:12:54,837 - FederatedClient - INFO - Successfully registered client:site2 for project simulator_server. Token:98af6db9-b718-4286-ad11-791e3466c5dc SSID:
2024-08-26 05:12:54,838 - SimulatorRunner - INFO - Set the client status ready.
2024-08-26 05:12:54,838 - SimulatorRunner - INFO - Deploy and start the Server App.
2024-08-26 05:12:54,844 - Cell - INFO - Register blob CB for channel='server_command', topic='*'
2024-08-26 05:12:54,844 - Cell - INFO - Register blob CB for channel='aux_communication', topic='*'
2024-08-26 05:12:54,845 - ServerCommandAgent - INFO - ServerCommandAgent cell register_request_cb: server.simulate_job
2024-08-26 05:12:55,808 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: Server runner starting ...
2024-08-26 05:12:55,810 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: starting workflow ridge_regression_workflow (<class 'controller.controller.SrrController'>) ...
2024-08-26 05:12:55,812 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: Workflow ridge_regression_workflow (<class 'controller.controller.SrrController'>) started
2024-08-26 05:12:55,814 - root - INFO - Workspace directory found at: /workspace
2024-08-26 05:12:55,816 - root - INFO - Parameters file path for simulator and poc: /workspace/test_data/server/parameters.json
2024-08-26 05:12:55,819 - SrrController - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: scheduled task perform_run_input_validation
2024-08-26 05:12:55,842 - SimulatorClientRunner - INFO - Start the clients run simulation.
2024-08-26 05:12:56,845 - SimulatorClientRunner - INFO - Simulate Run client: site1 on GPU group: None
2024-08-26 05:12:57,965 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00005 127.0.0.1:53227 <= 127.0.0.1:40340] is created: PID: 88272
2024-08-26 05:13:00,295 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, task_name=perform_run_input_validation, task_id=2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff]: assigned task to client site1: name=perform_run_input_validation, id=2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff
2024-08-26 05:13:00,298 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, task_name=perform_run_input_validation, task_id=2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff]: sent task assignment to client. client_name:site1 task_id:2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff
2024-08-26 05:13:00,299 - GetTaskCommand - INFO - return task to client.  client_name: site1  task_name: perform_run_input_validation   task_id: 2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff  sharable_header_task_id: 2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff
2024-08-26 05:13:00,362 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job]: got result from client site1 for task: name=perform_run_input_validation, id=2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff
2024-08-26 05:13:00,365 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, peer_rc=OK, task_name=perform_run_input_validation, task_id=2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff]: finished processing client result by ridge_regression_workflow
2024-08-26 05:13:00,366 - SubmitUpdateCommand - INFO - submit_update process. client_name:site1   task_id:2e5ddb6e-aaee-4d4c-9d32-605ff1fb6eff
2024-08-26 05:13:00,372 - SimulatorClientRunner - INFO - Simulate Run client: site2 on GPU group: None
2024-08-26 05:13:00,376 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00005 Not Connected] is closed PID: 88272
2024-08-26 05:13:02,485 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00006 127.0.0.1:53227 <= 127.0.0.1:40354] is created: PID: 88272
2024-08-26 05:13:04,705 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, task_name=perform_run_input_validation, task_id=f8bb618e-10be-4e73-99ca-c590f8fba21e]: assigned task to client site2: name=perform_run_input_validation, id=f8bb618e-10be-4e73-99ca-c590f8fba21e
2024-08-26 05:13:04,707 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, task_name=perform_run_input_validation, task_id=f8bb618e-10be-4e73-99ca-c590f8fba21e]: sent task assignment to client. client_name:site2 task_id:f8bb618e-10be-4e73-99ca-c590f8fba21e
2024-08-26 05:13:04,708 - GetTaskCommand - INFO - return task to client.  client_name: site2  task_name: perform_run_input_validation   task_id: f8bb618e-10be-4e73-99ca-c590f8fba21e  sharable_header_task_id: f8bb618e-10be-4e73-99ca-c590f8fba21e
2024-08-26 05:13:04,756 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job]: got result from client site2 for task: name=perform_run_input_validation, id=f8bb618e-10be-4e73-99ca-c590f8fba21e
2024-08-26 05:13:04,760 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, peer_rc=OK, task_name=perform_run_input_validation, task_id=f8bb618e-10be-4e73-99ca-c590f8fba21e]: finished processing client result by ridge_regression_workflow
2024-08-26 05:13:04,761 - SubmitUpdateCommand - INFO - submit_update process. client_name:site2   task_id:f8bb618e-10be-4e73-99ca-c590f8fba21e
2024-08-26 05:13:04,766 - SimulatorClientRunner - INFO - Simulate Run client: site1 on GPU group: None
2024-08-26 05:13:04,770 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00006 Not Connected] is closed PID: 88272
2024-08-26 05:13:04,833 - SrrController - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: task perform_run_input_validation exit with status TaskCompletionStatus.OK
2024-08-26 05:13:04,834 - SrrController - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: scheduled task save_global_validation_report
2024-08-26 05:13:06,890 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00007 127.0.0.1:53227 <= 127.0.0.1:45422] is created: PID: 88272
2024-08-26 05:13:09,126 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, task_name=save_global_validation_report, task_id=997be06b-4c8c-4074-945f-42cf98861add]: assigned task to client site1: name=save_global_validation_report, id=997be06b-4c8c-4074-945f-42cf98861add
2024-08-26 05:13:09,128 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, task_name=save_global_validation_report, task_id=997be06b-4c8c-4074-945f-42cf98861add]: sent task assignment to client. client_name:site1 task_id:997be06b-4c8c-4074-945f-42cf98861add
2024-08-26 05:13:09,129 - GetTaskCommand - INFO - return task to client.  client_name: site1  task_name: save_global_validation_report   task_id: 997be06b-4c8c-4074-945f-42cf98861add  sharable_header_task_id: 997be06b-4c8c-4074-945f-42cf98861add
2024-08-26 05:13:09,161 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job]: got result from client site1 for task: name=save_global_validation_report, id=997be06b-4c8c-4074-945f-42cf98861add
2024-08-26 05:13:09,163 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, peer_rc=OK, task_name=save_global_validation_report, task_id=997be06b-4c8c-4074-945f-42cf98861add]: finished processing client result by ridge_regression_workflow
2024-08-26 05:13:09,164 - SubmitUpdateCommand - INFO - submit_update process. client_name:site1   task_id:997be06b-4c8c-4074-945f-42cf98861add
2024-08-26 05:13:09,169 - SimulatorClientRunner - INFO - Simulate Run client: site2 on GPU group: None
2024-08-26 05:13:09,173 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00007 Not Connected] is closed PID: 88272
2024-08-26 05:13:11,287 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00008 127.0.0.1:53227 <= 127.0.0.1:45434] is created: PID: 88272
2024-08-26 05:13:13,559 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, task_name=save_global_validation_report, task_id=d24dc21c-f115-4dd6-b693-2cdc12bbf8db]: assigned task to client site2: name=save_global_validation_report, id=d24dc21c-f115-4dd6-b693-2cdc12bbf8db
2024-08-26 05:13:13,560 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, task_name=save_global_validation_report, task_id=d24dc21c-f115-4dd6-b693-2cdc12bbf8db]: sent task assignment to client. client_name:site2 task_id:d24dc21c-f115-4dd6-b693-2cdc12bbf8db
2024-08-26 05:13:13,561 - GetTaskCommand - INFO - return task to client.  client_name: site2  task_name: save_global_validation_report   task_id: d24dc21c-f115-4dd6-b693-2cdc12bbf8db  sharable_header_task_id: d24dc21c-f115-4dd6-b693-2cdc12bbf8db
2024-08-26 05:13:13,591 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job]: got result from client site2 for task: name=save_global_validation_report, id=d24dc21c-f115-4dd6-b693-2cdc12bbf8db
2024-08-26 05:13:13,593 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, peer_rc=OK, task_name=save_global_validation_report, task_id=d24dc21c-f115-4dd6-b693-2cdc12bbf8db]: finished processing client result by ridge_regression_workflow
2024-08-26 05:13:13,594 - SubmitUpdateCommand - INFO - submit_update process. client_name:site2   task_id:d24dc21c-f115-4dd6-b693-2cdc12bbf8db
2024-08-26 05:13:13,599 - SimulatorClientRunner - INFO - Simulate Run client: site1 on GPU group: None
2024-08-26 05:13:13,603 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00008 Not Connected] is closed PID: 88272
2024-08-26 05:13:13,654 - SrrController - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: task save_global_validation_report exit with status TaskCompletionStatus.OK
2024-08-26 05:13:13,849 - SrrController - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: scheduled task perform_regression
2024-08-26 05:13:15,725 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00009 127.0.0.1:53227 <= 127.0.0.1:33534] is created: PID: 88272
2024-08-26 05:13:17,973 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, task_name=perform_regression, task_id=f1bad30d-9497-4002-b60f-56244c6f6539]: assigned task to client site1: name=perform_regression, id=f1bad30d-9497-4002-b60f-56244c6f6539
2024-08-26 05:13:17,974 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, task_name=perform_regression, task_id=f1bad30d-9497-4002-b60f-56244c6f6539]: sent task assignment to client. client_name:site1 task_id:f1bad30d-9497-4002-b60f-56244c6f6539
2024-08-26 05:13:17,975 - GetTaskCommand - INFO - return task to client.  client_name: site1  task_name: perform_regression   task_id: f1bad30d-9497-4002-b60f-56244c6f6539  sharable_header_task_id: f1bad30d-9497-4002-b60f-56244c6f6539
2024-08-26 05:13:51,614 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job]: got result from client site1 for task: name=perform_regression, id=f1bad30d-9497-4002-b60f-56244c6f6539
2024-08-26 05:13:51,616 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site1, peer_run=simulate_job, peer_rc=EXECUTION_EXCEPTION, task_name=perform_regression, task_id=f1bad30d-9497-4002-b60f-56244c6f6539]: finished processing client result by ridge_regression_workflow
2024-08-26 05:13:51,617 - SubmitUpdateCommand - INFO - submit_update process. client_name:site1   task_id:f1bad30d-9497-4002-b60f-56244c6f6539
2024-08-26 05:13:51,623 - SimulatorClientRunner - INFO - Simulate Run client: site2 on GPU group: None
2024-08-26 05:13:51,628 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00009 Not Connected] is closed PID: 88272
2024-08-26 05:13:53,759 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00010 127.0.0.1:53227 <= 127.0.0.1:55094] is created: PID: 88272
2024-08-26 05:13:56,066 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, task_name=perform_regression, task_id=38d4de2f-a699-496e-98e9-05ddbab1c8f4]: assigned task to client site2: name=perform_regression, id=38d4de2f-a699-496e-98e9-05ddbab1c8f4
2024-08-26 05:13:56,068 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, task_name=perform_regression, task_id=38d4de2f-a699-496e-98e9-05ddbab1c8f4]: sent task assignment to client. client_name:site2 task_id:38d4de2f-a699-496e-98e9-05ddbab1c8f4
2024-08-26 05:13:56,069 - GetTaskCommand - INFO - return task to client.  client_name: site2  task_name: perform_regression   task_id: 38d4de2f-a699-496e-98e9-05ddbab1c8f4  sharable_header_task_id: 38d4de2f-a699-496e-98e9-05ddbab1c8f4
2024-08-26 05:25:14,085 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job]: got result from client site2 for task: name=perform_regression, id=38d4de2f-a699-496e-98e9-05ddbab1c8f4
2024-08-26 05:25:14,089 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow, peer=site2, peer_run=simulate_job, peer_rc=EXECUTION_EXCEPTION, task_name=perform_regression, task_id=38d4de2f-a699-496e-98e9-05ddbab1c8f4]: finished processing client result by ridge_regression_workflow
2024-08-26 05:25:14,090 - SubmitUpdateCommand - INFO - submit_update process. client_name:site2   task_id:38d4de2f-a699-496e-98e9-05ddbab1c8f4
2024-08-26 05:25:14,099 - SimulatorClientRunner - INFO - Simulate Run client: site1 on GPU group: None
2024-08-26 05:25:14,107 - nvflare.fuel.f3.sfm.conn_manager - INFO - Connection [CN00010 Not Connected] is closed PID: 88272
2024-08-26 05:25:14,261 - SrrController - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: task perform_regression exit with status TaskCompletionStatus.OK
2024-08-26 05:25:14,314 - ServerRunner - ERROR - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: Exception in workflow ridge_regression_workflow: KeyError: 'coefficients'
2024-08-26 05:25:14,325 - ServerRunner - ERROR - Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/nvflare/private/fed/server/server_runner.py", line 140, in _execute_run
    wf.responder.control_flow(self.abort_signal, fl_ctx)
  File "/workspace/app/code/controller/controller.py", line 81, in control_flow
    aggregate_result = self._aggregate_regression_results()
  File "/workspace/app/code/controller/controller.py", line 136, in _aggregate_regression_results
    return self.regression_aggregator.aggregate()
  File "/workspace/app/code/aggregator/regression_aggregator.py", line 31, in aggregate
    combined_result["coefficients"] = self._average_across_sites("coefficients")
  File "/workspace/app/code/aggregator/regression_aggregator.py", line 43, in _average_across_sites
    aggregated = [0] * len(self.site_results[0][key])
KeyError: 'coefficients'

2024-08-26 05:25:14,326 - ServerRunner - ERROR - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: Aborting current RUN due to FATAL_SYSTEM_ERROR received: Exception in workflow ridge_regression_workflow: KeyError: 'coefficients'
2024-08-26 05:25:14,327 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: asked to abort - triggered abort_signal to stop the RUN
2024-08-26 05:25:14,328 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: Workflow: ridge_regression_workflow finalizing ...
2024-08-26 05:25:14,464 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: ABOUT_TO_END_RUN fired
2024-08-26 05:25:14,465 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: Firing CHECK_END_RUN_READINESS ...
2024-08-26 05:25:14,466 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: END_RUN fired
2024-08-26 05:25:14,466 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=ridge_regression_workflow]: Server runner finished.
2024-08-26 05:25:14,521 - SimulatorServer - INFO - Server app stopped.


